---
import NearYouLayout from "../../layouts/NearYouLayout.astro";
import { supabase } from "../../lib/supabase";

const DEFAULT_NEAR_CATEGORY = "friseure";

const { data: categories, error } = await supabase
  .from("business_categories")
  .select("name, slug")
  .order("name")
  .limit(60);

if (error) {
  console.error("near-you index categories query error:", error);
}

const title = "Salons in deiner Naehe in Deutschland";
const description =
  "Waehle eine Kategorie und finde passende Anbieter in deiner Naehe. Optional mit Standort-Freigabe fuer bessere Ergebnisse.";
const canonical = "https://duolb.com/near-you";

const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  itemListElement: [
    { "@type": "ListItem", position: 1, name: "Startseite", item: "https://duolb.com/" },
    { "@type": "ListItem", position: 2, name: "Near You", item: canonical },
  ],
};
---

<NearYouLayout title={title} description={description} canonical={canonical}>
  <Fragment slot="head">
    <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
  </Fragment>

  <header class="near-you-header">
    <h1 class="near-you-title">Salons in deiner Naehe</h1>
    <p class="near-you-subtitle">
      Waehle eine Kategorie, dann zeigen wir dir Anbieter in der Umgebung.
    </p>
  </header>

  <section class="near-you-controls" aria-label="Kategorieauswahl">
    <div class="near-you-category-grid">
      {(categories || []).map((cat) => (
        <a class="near-you-category-card" href={`/near-you/${cat.slug}`}>
          <span class="near-you-category-name">{cat.name}</span>
        </a>
      ))}
    </div>

    {(!categories || categories.length === 0) && (
      <div class="near-you-empty">
        <div class="near-you-empty__inner">
          <h2>Keine Kategorien gefunden</h2>
          <a href={`/near-you/${DEFAULT_NEAR_CATEGORY}`} class="near-you-empty-btn">
            Trotzdem starten
          </a>
        </div>
      </div>
    )}
  </section>
</NearYouLayout>
