---
const label = "Go to top";
---

<button
  id="backToTop"
  aria-label={label}
  title={label}
  class="back-to-top fixed right-5 bottom-5 z-[9999]
         w-12 h-12 rounded-full
         bg-[#D8A7B1] text-[#FBF6F2]
         shadow-lg shadow-black/20
         flex items-center justify-center
         text-xl font-bold
         opacity-0 translate-y-2 pointer-events-none
         transition-all duration-200"
>
  ↑
</button>

<script is:inline>
  const initBackToTop = () => {
    const btn = document.getElementById("backToTop");
    const marker = document.getElementById("pageTopMarker");
    if (!btn || !marker) return;

    if (btn.dataset.initialized === "true") return;
    btn.dataset.initialized = "true";

    const show = () => {
      btn.classList.add("opacity-100", "translate-y-0", "pointer-events-auto");
      btn.classList.remove("opacity-0", "translate-y-2", "pointer-events-none");
    };

    const hide = () => {
      btn.classList.remove("opacity-100", "translate-y-0", "pointer-events-auto");
      btn.classList.add("opacity-0", "translate-y-2", "pointer-events-none");
    };

    const observer = new IntersectionObserver(([entry]) => {
      if (entry.isIntersecting) {
        hide();
      } else {
        show();
      }
    });

    observer.observe(marker);

    btn.addEventListener("click", () => {
      const reduce = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
      window.scrollTo({ top: 0, behavior: reduce ? "auto" : "smooth" });
    });
  };

  initBackToTop();
  document.addEventListener("astro:after-swap", initBackToTop);
</script>

<style>
  /* Hover effect using brand colors */
  .back-to-top:hover {
    background-color: #9CAF9A;
    color: #FBF6F2;
    transform: translateY(-2px);
  }

  .back-to-top:focus-visible {
    outline: 3px solid rgba(198, 167, 94, 0.55);
    outline-offset: 3px;
  }
</style>

